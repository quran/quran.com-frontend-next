@use 'src/styles/breakpoints';
@use 'src/styles/utility';

$gap-between-blocks: 1rem;
$hadith-font-line-height: 1.6;

.container {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-medium-px);
}

.content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-medium-px);

  &,
  & * {
    line-height: $hadith-font-line-height;
  }
}

.hadithBody {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-medium-px);
  color: var(--color-text-default-new);
  @include utility.kitabFontLang;

  /*
   * ========================================================================
   * ARABIC TEXT SELECTION FIX
   * ========================================================================
   *
   * Issue: Arabic text selection fails when using the Kitab font in hadith tab (e.g., quran.com/33:66/hadith).
   *
   * Root Cause: The main issue occurs when the Right-to-Left Mark (RLM) character
   * (U+200F, HTML entity &rlm;) is present in the hadith text. When selecting Arabic
   * text rendered with the Kitab font that contains RLM characters, the browser's bidi
   * (bidirectional text) algorithm conflicts with the font's complex ligature
   * rendering, causing text selection to fail or behave erratically.
   *
   * The RLM character is an invisible control character used to properly directionally
   * isolate text in mixed LTR/RTL contexts. However, when combined with the Kitab
   * font's sophisticated ligature system, it creates bidirectional formatting
   * conflicts that break the browser's text selection mechanism.
   *
   * Solution: Apply unicode-bidi: isolate to:
   * 1. Create a separate directional context for the hadith text container
   * 2. Prevent the bidi algorithm from interfering with text selection
   * 3. Isolate the Kitab font rendering from parent/adjacent elements
   * 4. Properly handle RLM characters without breaking text selection
   *
   * Why this works:
   * - 'isolate' creates a new bidi formatting context that treats the element
   *   as if it were surrounded by bidi-neutral characters (like parentheses)
   * - This prevents the browser's bidi resolution from merging adjacent text
   *   runs, which was causing the selection issue with RLM characters
   * - The nested selector (&, & *) ensures all child elements also maintain
   *   this isolation, preserving the fix throughout the hadith text hierarchy
   * - The RLM character can still perform its intended function (directional
   *   isolation) but without breaking text selection
   *
   * Trade-offs:
   * - No removal of Kitab font or special characters (including RLM) needed
   * - Text selection remains fully functional
   * - No visual or behavioral regressions
   * - Minimal performance impact (CSS isolation is lightweight)
   *
   * References:
   * - CSS Writing Modes Level 3: https://www.w3.org/TR/css-writing-modes-3/#unicode-bidi
   * - MDN unicode-bidi documentation: https://developer.mozilla.org/en-US/docs/Web/CSS/unicode-bidi
   * - Similar fixes used in other RTL (right-to-left) text applications
   */
  unicode-bidi: isolate;

  &,
  & * {
    unicode-bidi: isolate;
  }

  p {
    margin: 0;
    padding: 0;

    :global(.multiline) {
      display: block;
      block-size: $gap-between-blocks;
    }

    :global(.single) {
      display: block;
      block-size: $gap-between-blocks * 0.5;
    }
  }

  &:not([data-lang='ar']) * {
    font-weight: var(--font-weight-light);
  }
}

.toggleButton {
  background: transparent;
  border: none;
  cursor: pointer;
  color: var(--color-text-default-new);
  font-weight: var(--font-weight-bold);
  padding: 0;
  margin: 0;
  text-align: start;
  max-inline-size: max-content;

  &:hover {
    text-decoration: underline;
    text-underline-offset: var(--spacing-micro2-px);
  }
}
